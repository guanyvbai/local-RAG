<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>注册 - 本地知识问答</title>
    <style>
        body { background-color: #131314; color: #e3e3e3; font-family: sans-serif; display: flex; align-items: center; justify-content: center; height: 100vh; margin: 0; }
        .register-container { background-color: #1e1f20; padding: 2rem 3rem; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.2); text-align: center; width: 360px; }
        h1 { margin-top: 0; }
        .form-group { margin-bottom: 1.5rem; text-align: left; }
        label { display: block; margin-bottom: 0.5rem; }
        input { width: 100%; padding: 0.8rem; background-color: #3c4043; border: 1px solid #5f6368; border-radius: 4px; color: #e3e3e3; font-size: 1rem; box-sizing: border-box; }
        button { width: 100%; padding: 0.8rem; background-color: #8ab4f8; color: #202124; border: none; border-radius: 4px; font-size: 1rem; cursor: pointer; font-weight: bold; }
        #message { height: 1rem; margin-top: 1rem; }
        .login-link { margin-top: 1.5rem; font-size: 0.9rem; }
        a { color: #8ab4f8; text-decoration: none; }
    </style>
</head>
<body>
    <div class="register-container">
        <h1>创建账户</h1>
        <form id="register-form">
            <div class="form-group">
                <label for="username">用户名 (3-50字符)</label>
                <input type="text" id="username" name="username" required minlength="3" maxlength="50">
            </div>
            <div class="form-group">
                <label for="password">密码 (至少6位)</label>
                <input type="password" id="password" name="password" required minlength="6">
            </div>
            <div class="form-group">
                <label for="confirm_password">确认密码</label>
                <input type="password" id="confirm_password" name="confirm_password" required minlength="6">
            </div>
            <button type="submit">注 册</button>
        </form>
        <p id="message"></p>
        <div class="login-link">
            已有账户? <a href="/login">立即登录</a>
        </div>
    </div>
    <script>
        const form = document.getElementById('register-form');
        const messageElem = document.getElementById('message');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            messageElem.textContent = '';
            messageElem.style.color = '#f28b82'; // red for errors

            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirm_password').value;

            if (password !== confirmPassword) {
                messageElem.textContent = '两次输入的密码不一致！';
                return;
            }

            try {
                const response = await fetch('/api/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });

                const data = await response.json();

                if (response.ok) {
                    messageElem.style.color = '#81c995'; // green for success
                    messageElem.textContent = '注册成功！正在跳转到登录页面...';
                    setTimeout(() => {
                        window.location.href = '/login';
                    }, 2000);
                } else {
                    messageElem.textContent = data.detail || '注册失败';
                }
            } catch (error) {
                messageElem.textContent = '网络错误，请稍后重试。';
            }
        });
    </script>
</body>
</html>